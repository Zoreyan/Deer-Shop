{% load static %}
<html lang="ru" class="light-style layout-navbar-fixed layout-menu-fixed layout-compact" dir="ltr"
  data-theme="theme-default" data-assets-path="{% static 'assets/' %}" data-template="vertical-menu-template">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <title>DEER - Регистрация</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap" rel="stylesheet">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="shortcut icon" href="{% static 'assets/img/logo/logo.svg' %}" type="image/x-icon">
  <link rel="stylesheet" href="{% static 'assets/vendor/libs/node-waves/node-waves.css'  %}" />
  <link rel="stylesheet" href="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css'  %}" />
  <link rel="stylesheet" href="{% static 'assets/vendor/css/rtl/core.css'  %}" class="template-customizer-core-css" />
  <link rel="stylesheet" href="{% static 'assets/vendor/css/pages/page-auth.css'  %}" />
  <link rel="stylesheet" href="{% static 'assets/vendor/css/rtl/theme-default.css'  %}" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="{% static 'assets/css/demo.css'  %}" />

  <script src="{% static 'assets/vendor/js/helpers.js'  %}"></script>
  <script src="{% static 'assets/vendor/js/template-customizer.js'  %}"></script>
  <script src="{% static 'assets/js/config.js'  %}"></script>
</head>
<body class="authentication-bg position-relative" cz-shortcut-listen="true">

  <div class="container-xxl">
    <div class="authentication-wrapper authentication-basic container-p-y">
      <div class="col-12 col-sm-12 col-md-8 col-lg-8 col-xl-8">
        <!-- Регистрация -->
        <div class="card px-sm-3 px-0">
          <div class="card-body">
            <div class="app-brand justify-content-center">
              <a href="#" class="app-brand-link gap-2">
                <span class="demo text-heading fw-bold fs-2">DEER SAP</span>
              </a>
            </div>
            <h4 class="mb-1">Добро пожаловать в DEER SAP</h4>
            <p class="mb-1">Пожалуйста, создайте свой аккаунт</p>
            <p class="text-muted">Для владельцев магазина</p>

            <!-- Многоступенчатая форма регистрации -->
            <form id="formAuthentication" method="POST" novalidate="novalidate">
              {% csrf_token %}

              <!-- Шаг 1: Регистрация пользователя -->
                <div id="step-1">
                  <h5>Создайте аккаунт</h5>
                  <div class="mb-3">
                    <label for="username" class="form-label">Логин</label>
                    {{ user_form.username }}
                  </div>

                  <div class="mb-3">
                    <label for="email" class="form-label">Электронная почта</label>
                    {{ user_form.email }}
                  </div>

                  <div class="mb-3 form-password-toggle">
                    <label class="form-label" for="password1">Пароль</label>
                    {{ user_form.password1 }}
                  </div>

                  <div class="mb-3 form-password-toggle">
                    <label class="form-label" for="password2">Подтвердите пароль</label>
                    {{ user_form.password2 }}
                  </div>
                </div>

                <!-- Шаг 2: Магазин -->
                <div id="step-2" style="display: none;">
                  <h5>Создайте магазин</h5>
                  <div class="row">
                    <div class="mb-3 col-md-6">
                      <label for="name" class="form-label">Название магазина</label>
                      {{ shop_form.name }}
                    </div>
                    <div class="mb-3 col-md-6">
                      <label for="address" class="form-label">Адрес</label>
                      {{ shop_form.address }}
                    </div>
                  </div>
                  <div class="row">
                    <div class="mb-3 col-md-6">
                      <label for="coordinates" class="form-label">Координаты</label>
                      {{ shop_form.coordinates }}
                    </div>
                    <div class="mb-3 col-md-6">
                      <label for="contacts" class="form-label">Контакты</label>
                      {{ shop_form.contacts }}
                    </div>
                  </div>
                  <div class="row">
                    <div class="mb-3 col-md-6">
                      <label for="about" class="form-label">О нас</label>
                      {{ shop_form.about }}
                    </div>
                    <div class="mb-3 col-md-6">
                      <label for="opening_hours" class="form-label">Часы работы</label>
                      {{ shop_form.opening_hours }}
                    </div>
                  </div>
                </div>

              <!-- Шаг 3: Выбор тарифа -->
              <div id="step-3" style="display: none;">

                <div class="mb-3" style="height: 270px; overflow-y: auto;">
                  <h3>Условия использования</h3>
                  <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Nihil, facere error. Hic illum id iure harum alias! Ratione architecto quam, nulla magni tempora officia corporis quos. Non excepturi aperiam ratione architecto quis cum suscipit voluptatem nostrum. Dolorem natus, adipisci facilis rem perspiciatis est! Cumque quia exercitationem unde, nemo assumenda veritatis praesentium eligendi quidem enim doloribus maxime sed, ducimus soluta! Quo hic consequuntur deleniti quos reprehenderit fugiat iusto mollitia enim illo, facilis ratione ex explicabo aspernatur itaque perspiciatis accusantium repudiandae praesentium numquam nulla et repellat earum ipsa? Quia, officia cum ab sit repellendus veritatis a totam ipsum libero, delectus maxime quisquam repudiandae architecto itaque velit accusamus mollitia officiis autem, deleniti quibusdam suscipit alias. Magni vero, harum ex quisquam nobis dignissimos, animi tempora perspiciatis debitis eos quis explicabo. Omnis vitae, mollitia deserunt facilis corrupti rerum reprehenderit eos enim vel animi quibusdam sunt dignissimos corporis veniam sed incidunt totam quae a illo numquam nam exercitationem. Inventore nesciunt quis nostrum doloremque, molestiae eveniet perferendis odit possimus, iure facere quibusdam qui hic sint recusandae soluta. Numquam adipisci quaerat iste debitis. Nostrum necessitatibus nulla ducimus quas rem ipsa consequuntur asperiores ullam. Nemo tempora harum a eum eius provident excepturi assumenda numquam distinctio! Ad, illo consequuntur? Odio, a rerum nam sint voluptas laboriosam dolorem aliquam reprehenderit repudiandae sunt adipisci qui cupiditate, magni asperiores veniam omnis aperiam totam ut doloremque earum? Tenetur odio excepturi ab sunt temporibus iure aliquam reiciendis laboriosam cum ipsam eaque cumque commodi accusamus mollitia omnis, aperiam quod vitae. Maxime harum omnis provident suscipit pariatur deserunt in modi? Laudantium, voluptatum cum commodi veniam iste non, facilis autem dolores quibusdam vero sit inventore numquam? Et accusamus sit officia. Laborum dignissimos placeat autem. Dolorem pariatur ex, distinctio numquam necessitatibus atque. Totam itaque, nostrum ad, nam modi quae libero harum aut dignissimos dolore consequuntur eum optio error tempore.</p>
                </div>
                
                <div class="form-check mt-4">
                  <input class="form-check-input" type="checkbox" id="termsCheckbox">
                  <label class="form-check-label" for="termsCheckbox">
                      Я полностью прочитал и соглашаюсь с условиями использования
                  </label>
                </div>

              </div>

              <!-- Общая ошибка -->
              <div class="row mt-4">
                <div class="col-md-4">
                  {% if errors.user_form %}
                  <h6 class="text-danger">Ошибки в шаге 1</h6>
                  {% for field, field_errors in errors.user_form.items %}
                  {% for error in field_errors %}
                  <p class="text-danger">Поле {{ field }}: {{ error }}</p>
                  {% endfor %}
                  {% endfor %}
                  {% endif %}
                </div>
                <div class="col-md-4">
                  {% if errors.shop_form %}
                  <h6 class="text-danger">Ошибки в шаге 2</h6>
                  {% for field, field_errors in errors.shop_form.items %}
                  {% for error in field_errors %}
                  <p class="text-danger">Поле {{ field }}: {{ error }}</p>
                  {% endfor %}
                  {% endfor %}
                  {% endif %}
                </div>
              </div>

              <!-- Кнопки перехода между шагами -->
              <div class="d-flex justify-content-between mt-4">
                <button type="button" id="prev-btn" class="btn btn-secondary" style="display: none;">Назад</button>
                <button type="button" id="next-btn" class="btn btn-primary ms-auto">Далее</button>
              </div>

              <div class="mb-2">
                <div class="d-flex justify-content-between mt-4">
                  <a href="{% url 'login' %}">
                    <span>Уже есть аккаунт?</span>
                  </a>
                </div>
              </div>

              <div class="mb-3 mt-4 d-flex justify-content-center">
                <button class="btn btn-primary d-grid w-50" type="submit" id="submit-btn" style="display: none;" disabled>Создать аккаунт</button>
              </div>
            </form>
          </div>
        </div>
    </div>
  </div>
</div>
<style>
  .form-check-input-tarif:checked {
  background-color: #500ba0;
  border-color: #500ba0;
}

.form-check-input:focus {
  box-shadow: 0 0 0 0.25rem rgba(80, 11, 160, 0.5);
}

.form-check-label-tarif {
  transition: all 0.3s ease;
}

.form-check-label-tarif:hover {
  color: #500ba0;
  font-weight: bold;
}
</style>
  <script>
    let currentStep = 1;
    const totalSteps = 3;
    const nextBtn = document.getElementById("next-btn");
    const prevBtn = document.getElementById("prev-btn");
    const submitBtn = document.getElementById("submit-btn");
  
    nextBtn.addEventListener("click", function () {
      if (currentStep < totalSteps) {
        currentStep++;
        updateStep();
      }
    });
  
    prevBtn.addEventListener("click", function () {
      if (currentStep > 1) {
        currentStep--;
        updateStep();
      }
    });
  
    function updateStep() {
      // Скрываем все шаги
      for (let i = 1; i <= totalSteps; i++) {
        document.getElementById(`step-${i}`).style.display = "none";
      }
      // Показываем текущий шаг
      document.getElementById(`step-${currentStep}`).style.display = "block";
  
      // Обновляем кнопки
      if (currentStep === 1) {
        prevBtn.style.display = "none";
        nextBtn.style.display = "inline-block";
        submitBtn.style.display = "none";
      } else if (currentStep === totalSteps) {
        nextBtn.style.display = "none";
        prevBtn.style.display = "inline-block";
        submitBtn.style.display = "inline-block";
      } else {
        nextBtn.style.display = "inline-block";
        prevBtn.style.display = "inline-block";
        submitBtn.style.display = "none";
      }
  
      // Проверяем, все ли поля на текущем шаге заполнены
      toggleSubmitButton();
    }
  
    const termsCheckbox = document.getElementById('termsCheckbox');

    termsCheckbox.addEventListener('change', toggleSubmitButton);

    function toggleSubmitButton() {
        // Проверка, что чекбокс отмечен и остальные условия выполняются
        if (termsCheckbox.checked && currentStep === totalSteps) {
            submitBtn.disabled = false;
        } else {
            submitBtn.disabled = true;
        }
    }

  // Вешаем слушатель на чекбокс и радиокнопки тарифов
  document.addEventListener("DOMContentLoaded", function() {
      document.getElementById("flexCheckChecked").addEventListener("change", toggleSubmitButton);
      document.querySelectorAll('input[name="tariff"]').forEach(radio => {
          radio.addEventListener("change", toggleSubmitButton);
      });
  });
  
    updateStep(); // Инициализируем с первого шага
  </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
