{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center mt-5">

  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="card-header py-0 d-flex flex-column flex-md-row align-items-center">
          <div>
            <div id="DataTables_Table_0_filter" class="dataTables_filter ms-n3 mb-0 mb-md-6"><label><input type="search"
                  class="form-control" placeholder="Поиск очереди" aria-controls="DataTables_Table_0"></label></div>
          </div>
        </div>
        <table class="table table-centered w-100" id="products-datatable">
          <thead>
            <tr>
              <th>#</th>
              <th>Итого</th>
              <th>Принято</th>
              <th>Сдача</th>
              <th>Дата</th>
              <th>Тип оплаты</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody id="product-table-body">
            {% for order in page_obj %}
            <tr>
              <td>
                <span class="text-primary" data-bs-toggle="modal" data-bs-target="#orderModal{{ order.id }}"><i
                    class="mdi mdi-cart me-1"></i>#{{ order.id }}</span>
                <div id="orderModal{{ order.id }}" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-body">
                        <span class="text-primary mb-1 fw-bold fs-4">
                          <i class="mdi mdi-cart me-1"></i>#{{ order.id }}
                        </span>
                        {% for i in order.soldhistory_set.all %}
                        <p>{{ i.product.name }}. {{ i.quantity }}шт. {{ i.total_sum }}C</p>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              </td>
              <td>{{ order.total_sum }}</td>
              <td>{{ order.amount }}</td>
              <td>{{ order.change }}</td>
              <td>{{ order.created }}</td>
              <td>Mbank</td>
              <td>

                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal"
                  data-bs-target="#deleteModal"><i class="mdi mdi-cart me-1"></i>Удалить</button>
                <div id="deleteModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-body">
                        <form class="ps-3 pe-3" method="POST">
                          {% csrf_token %}
                          <p>Вы действительно хотите удалить этот ордер?</p>
                          <div class="mb-3 text-end">
                            <a class="btn btn-danger btn-sm" href="{% url 'order-history-delete' order.id %}">
                              Удалить
                            </a>
                          </div>
                        </form>
                      </div>
                    </div><!-- /.modal-content -->
                  </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
      <div class="d-flex justify-content-center mt-5">
        <div class="pagination-container">
            <nav aria-label="Пагинация">
                <ul class="pagination justify-content-center">
                    <!-- Кнопка "Первая" -->
                    {% if page_obj.number > 1 %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1" aria-label="Первая">
                                <span aria-hidden="true">&laquo;&laquo;</span>
                                <span class="sr-only">Первая</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&laquo;&laquo;</span>
                        </li>
                    {% endif %}
        
                    <!-- Кнопка "Назад" -->
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Назад">
                                <span aria-hidden="true">&laquo;</span>
                                <span class="sr-only">Назад</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&laquo;</span>
                        </li>
                    {% endif %}
        
                    <!-- Номера страниц -->
                    {% for page_num in visible_pages %}
                        {% if page_num == page_obj.number %}
                            <li class="page-item active" aria-current="page">
                                <span class="page-link">{{ page_num }}</span>
                            </li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
        
                    <!-- Кнопка "Вперёд" -->
                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Вперёд">
                                <span aria-hidden="true">&raquo;</span>
                                <span class="sr-only">Вперёд</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&raquo;</span>
                        </li>
                    {% endif %}
        
                    <!-- Кнопка "Последняя" -->
                    {% if page_obj.number < page_obj.paginator.num_pages %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Последняя">
                                <span aria-hidden="true">&raquo;&raquo;</span>
                                <span class="sr-only">Последняя</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&raquo;&raquo;</span>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            <div class="d-flex justify-content-center">
            <span class="text-muted">
                Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}
            </span>
            </div>
        </div>

    </div>
  </div>



  {% endblock %}